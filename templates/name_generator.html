{% extends "base.html" %}

{% block title %}ü™Ñ Creative Name Generator - Photoroom UA Video Tools{% endblock %}

{% set use_main_container = true %}
{% set current_tool = "Creative Name Generator" %}

{% block head %}
<style>
        /* Page-specific styles - design tokens handle the base styles */
        .header{ text-align:center; margin-bottom:30px; color:var(--ink-1); }

        /* Animations keep same, just shift glows into palette */
        @keyframes inputShimmer{
            0%,100%{ box-shadow:0 10px 30px rgba(102,126,234,.30), 0 0 20px rgba(118,75,162,.20); }
            50%    { box-shadow:0 15px 40px rgba(102,126,234,.50), 0 0 30px rgba(118,75,162,.40); }
        }
        @keyframes inputShine{
            0%{ transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100%{ transform: translateX(100%) translateY(100%) rotate(45deg); }
        }
        @keyframes previewShimmer{
            0%,100%{ box-shadow:0 10px 30px rgba(122,167,255,.30), 0 0 20px rgba(77,136,255,.20); }
            50%    { box-shadow:0 15px 40px rgba(122,167,255,.50), 0 0 30px rgba(77,136,255,.40); }
        }
        @keyframes previewShine{
            0%{ transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100%{ transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        /* Design tokens handle form elements, buttons, and section styling */

        /* Generated name card */
        .generated-name{
            background:linear-gradient(135deg, var(--neutral-1), var(--neutral-2));
            border:2px solid var(--indigo-1);
            border-radius:15px; padding:20px; margin:20px 0; text-align:center; position:relative;
        }
        .generated-name .name-text{
            font-family:'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', 'Source Code Pro', monospace; font-size:1.3em; font-weight:bold; color:var(--ink-2); word-break:break-all; margin-bottom:15px; line-height:1.4;
        }

        /* Copy buttons ‚Äî from green -> indigo */
        .copy-btn{
            background: linear-gradient(135deg, var(--indigo-1), var(--indigo-2));
            color:var(--white); border:none; border-radius:8px; padding:8px 16px; cursor:pointer; transition:all .3s ease;
            box-shadow:0 4px 12px rgba(102,126,234,.25);
        }
        .copy-btn:hover{ transform:translateY(-1px); filter:brightness(1.05); }
        .copy-btn.copied{ background: linear-gradient(135deg, var(--accent-1), var(--accent-2)); }

        /* Rule/format blocks aligned to palette */
        .rule-card{
            background:var(--neutral-1);
            border-left:4px solid var(--indigo-1);
            border-radius:8px; padding:15px; margin:15px 0;
        }
        .format-display{
            background:var(--lavender-1);
            border:1px solid var(--lavender-2);
            border-radius:8px; padding:15px; font-family:'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', 'Source Code Pro', monospace; font-size:.9em; margin:15px 0;
        }
        .tag-example{
            background:var(--lavender-1);
            border:1px solid var(--lavender-2);
            border-radius:5px; padding:8px 12px; margin:5px; display:inline-block; font-family:'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', 'Source Code Pro', monospace; font-size:.85em;
        }
        
        /* Feature tag styling with colors */
        .tag-core{
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 20px;
            padding: 8px 16px;
            margin: 5px;
            display: inline-block;
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', 'Source Code Pro', monospace;
            font-size: .85em;
            font-weight: 600;
            border: none;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }
        
        .tag-tools{
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            border-radius: 20px;
            padding: 8px 16px;
            margin: 5px;
            display: inline-block;
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', 'Source Code Pro', monospace;
            font-size: .85em;
            font-weight: 600;
            border: none;
            box-shadow: 0 2px 8px rgba(40, 167, 69, 0.3);
        }
        
        .tag-imgt{
            background: linear-gradient(135deg, #fd7e14, #e83e8c);
            color: white;
            border-radius: 20px;
            padding: 8px 16px;
            margin: 5px;
            display: inline-block;
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', 'Source Code Pro', monospace;
            font-size: .85em;
            font-weight: 600;
            border: none;
            box-shadow: 0 2px 8px rgba(253, 126, 20, 0.3);
        }
        
        .tag-experimental{
            background: linear-gradient(135deg, #6f42c1, #e83e8c);
            color: white;
            border-radius: 20px;
            padding: 8px 16px;
            margin: 5px;
            display: inline-block;
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', 'Source Code Pro', monospace;
            font-size: .85em;
            font-weight: 600;
            border: none;
            box-shadow: 0 2px 8px rgba(111, 66, 193, 0.3);
        }

        /* Preview panel (right) ‚Äî shift from cyan to unified accent indigo/blue) */
        .preview-name-container{
            background: linear-gradient(135deg, var(--accent-1) 0%, var(--accent-2) 100%) !important;
            border:3px solid transparent; border-radius:20px;
            box-shadow:0 10px 30px rgba(122,167,255,.30), 0 0 20px rgba(77,136,255,.20);
            position:relative; overflow:hidden; animation:previewShimmer 3s ease-in-out infinite; margin-bottom:20px;
        }

        /* Design tokens handle navbar styling */

        .form-label{ font-weight:600; color:var(--ink-2); margin-bottom:8px; }
        .input-group{ margin-bottom:20px; }

        .creator-type-badge{
            background:var(--indigo-1); color:var(--surface-1); padding:4px 8px; border-radius:12px; font-size:.75em; margin-left:5px;
        }

        /* Fancy input container keeps purple gradient */
        .creative-name-container{
            background: linear-gradient(135deg, var(--indigo-1) 0%, var(--indigo-2) 100%) !important;
            border:3px solid transparent; border-radius:20px;
            box-shadow:0 10px 30px rgba(102,126,234,.30), 0 0 20px rgba(118,75,162,.20);
            position:relative; overflow:hidden; animation:inputShimmer 3s ease-in-out infinite;
        }
        .creative-name-input:focus{
            border-color: rgba(255,255,255,.8) !important;
            box-shadow: inset 0 2px 10px rgba(0,0,0,.1), 0 0 20px rgba(255,255,255,.5) !important;
            transform:scale(1.02);
        }
        .creative-name-container:hover{
            transform:translateY(-2px);
            box-shadow:0 15px 40px rgba(102,126,234,.4), 0 0 30px rgba(118,75,162,.3);
        }
        .preview-section{
            background: linear-gradient(135deg, var(--neutral-1), var(--neutral-2));
            border-radius:10px; padding:20px; margin-top:20px;
        }
        .preview-label{ font-weight:600; color:var(--ink-2); margin-bottom:10px; }
        .preview-text{
            font-family:'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', 'Source Code Pro', monospace;
            background:var(--white);
            border:1px solid #dee2e6;
            border-radius:5px; padding:10px; font-size:.9em; word-break:break-all;
        }

        /* Iteration panel: replace green gradient with palette gradient */
        .section .generated-name + .btn,
        .section .generated-name .btn{ /* safeguard, but we'll style the actual iteration block below */
            background:linear-gradient(135deg, var(--indigo-1), var(--indigo-2));
            color:var(--white);
        }
        /* Specific iteration section card that had green */
        .section .sticky-top .generated-name{
            background: linear-gradient(135deg, var(--indigo-1), var(--indigo-2)) !important;
            color:var(--white);
            border: none;
        }
        #iterationCopyBtn{ background: rgba(255,255,255,.2) !important; color:var(--white); }

        /* Feature tag buttons ‚Äî align Bootstrap outline to our palette */
        .btn-outline-primary{
            color: var(--indigo-1);
            border-color: var(--indigo-1);
        }
        .btn-outline-primary:hover,
        .btn-outline-primary.active{
            color: var(--white);
            background-color: var(--indigo-1);
            border-color: var(--indigo-1);
        }
        .btn-outline-secondary{
            color: #8b8e99;
            border-color: #cfd3da;
        }
    </style>
{% endblock %}

{% block content %}

        <div class="header">
            <h1><i class="fas fa-magic"></i> Creative Name Generator</h1>
            <blockquote style="
                font-style: italic;
                color: #6c757d;
                margin: 20px auto;
                text-align: center;
                max-width: 500px;
            ">
                Make videos, not filenames that look like Wi-Fi passwords.
            </blockquote>
        </div>


        <!-- Form and Preview Side by Side -->
        <div class="row">
            <!-- Left: Form -->
            <div class="col-lg-8">
                <!-- Name Generator Form -->
        <div class="section">
            <h3><i class="fas fa-form"></i> Generate Your Creative Name</h3>
            
            <div class="row">
                <!-- Form in more compact layout -->
                <div class="col-12">
                    <form id="nameGeneratorForm">
                        <div class="row">
                            <!-- Left Column -->
                            <div class="col-md-6">
                                <!-- Creator Type -->
                                <div class="mb-3">
                                    <label for="creatorType" class="form-label">
                                        <i class="fas fa-briefcase"></i> Creator Type
                                    </label>
                                    <select class="form-select" id="creatorType" onchange="updateCreatorTypeFields(); updatePreview()">
                                        <option value="">Select creator type...</option>
                                        <option value="internal" selected>Internal</option>
                                        <option value="freelancer">Freelancer</option>
                                        <option value="ramdam">Ramdam</option>
                                        <option value="influencer">Influencer</option>
                                    </select>
                                    <small class="text-muted">Type of content creator</small>
                                </div>

                                <!-- Creator Name (for non-internal) -->
                                <div class="mb-3" id="creatorNameDiv" style="display: none;">
                                    <label for="creatorName" class="form-label" id="creatorNameLabel">
                                        <i class="fas fa-user"></i> Creator Name
                                    </label>
                                    <input type="text" class="form-control" id="creatorName" placeholder="such as artlina333, Jeremy" 
                                           onchange="formatInputToCamelCase('creatorName')" oninput="formatInputToCamelCase('creatorName')">
                                    <small class="text-muted" id="creatorNameNote">(‚ÄúIf you‚Äôre internal, no need to type your name ‚Äî AdManage adds it automatically)</small>
                                </div>

                        <!-- Creative Name - Premium Bling Style -->
                        <div class="mb-3 p-4 creative-name-container" style="
                            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                            border: 3px solid transparent;
                            border-radius: 20px;
                            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3), 0 0 20px rgba(118, 75, 162, 0.2);
                            position: relative;
                            overflow: hidden;
                            animation: inputShimmer 3s ease-in-out infinite;
                        ">
                            <!-- Animated background overlay -->
                            <div style="
                                position: absolute;
                                top: -50%;
                                left: -50%;
                                width: 200%;
                                height: 200%;
                                background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.1) 50%, transparent 70%);
                                animation: inputShine 2.3s ease-in-out infinite;
                                pointer-events: none;
                            "></div>
                            
                            <label for="filename" class="form-label" style="
                                font-weight: 700; 
                                color: white; 
                                font-size: 1.3em;
                                text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
                                margin-bottom: 15px;
                                display: flex;
                                align-items: center;
                                gap: 10px;
                            ">
                                <span style="font-size: 1.2em;">‚ú®</span>
                                <span>Type here</span>
                                <span style="font-size: 1.2em;">‚ú®</span>
                            </label>
                            
                            <input type="text" class="form-control form-control-lg creative-name-input" id="filename" 
                                   placeholder="such as: my blue hoodie" 
                                   onchange="formatCreativeName()" oninput="updatePreviewDebounced()" 
                                   style="
                                       border: 3px solid rgba(255,255,255,0.3);
                                       background: rgba(255,255,255,0.95);
                                       font-size: 1.2em;
                                       font-weight: 600;
                                       border-radius: 15px;
                                       padding: 15px 20px;
                                       box-shadow: inset 0 2px 10px rgba(0,0,0,0.1);
                                       transition: all 0.3s ease;
                                   ">
                                   
                            <small style="
                                color: rgba(255,255,255,0.9);
                                font-weight: 500;
                                font-size: 0.9em;
                                text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
                                display: flex;
                                align-items: center;
                                gap: 5px;
                                margin-top: 10px;
                                margin-bottom: 15px;
                            ">
                                <span>ü™Ñ</span>
                                <span>Auto-formats & auto-numbers: "dirty kitchen" ‚Üí "DirtyKitchen-1"</span>
                                <span>üíé</span>
                            </small>
                            
                            <!-- Creative Name Number Selector -->
                            <div style="
                                display: flex;
                                align-items: center;
                                gap: 10px;
                                background: rgba(255,255,255,0.15);
                                padding: 12px 16px;
                                border-radius: 12px;
                                border: 2px solid rgba(255,255,255,0.2);
                            ">
                                <label for="creativeNumber" style="
                                    color: white;
                                    font-weight: 600;
                                    font-size: 0.9em;
                                    text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
                                    margin: 0;
                                    display: flex;
                                    align-items: center;
                                    gap: 5px;
                                ">
                                    <span>üî¢</span>
                                    <span>Variation Number:</span>
                                </label>
                                <input type="number" id="creativeNumber" value="1" min="1" max="999" 
                                       onchange="updatePreviewDebounced()"
                                       style="
                                           width: 80px;
                                           padding: 8px 12px;
                                           border: 2px solid rgba(255,255,255,0.3);
                                           border-radius: 8px;
                                           background: rgba(255,255,255,0.9);
                                           font-weight: 600;
                                           font-size: 1em;
                                           text-align: center;
                                           color: #333;
                                       ">
                                <small style="
                                    color: rgba(255,255,255,0.8);
                                    font-size: 0.8em;
                                    text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
                                ">
                                    ‚ú® 
                                </small>
                            </div>
                        </div>

                            </div>

                            <!-- Right Column -->
                            <div class="col-md-6">
                                <!-- Feature Tags moved here for better layout -->
                                <div class="mb-3">
                                    <label class="form-label">
                                        <i class="fas fa-star"></i> Feature Tags
                                    </label>
                                    <div class="d-flex flex-wrap gap-2" id="featureTagsContainer">
                                        <button type="button" class="btn btn-outline-primary btn-sm feature-tag-btn active" data-value="AIBG" onclick="selectFeatureTag(this)">
                                            AIBG
                                        </button>
                                        <button type="button" class="btn btn-outline-secondary btn-sm feature-tag-btn" data-value="STORY" onclick="selectFeatureTag(this)">
                                            STORY
                                        </button>
                                        <button type="button" class="btn btn-outline-secondary btn-sm feature-tag-btn" data-value="LOGO" onclick="selectFeatureTag(this)">
                                            LOGO
                                        </button>
                                        <button type="button" class="btn btn-outline-secondary btn-sm feature-tag-btn" data-value="ANIM" onclick="selectFeatureTag(this)">
                                            ANIM
                                        </button>
                                        <button type="button" class="btn btn-outline-secondary btn-sm feature-tag-btn" data-value="MIX" onclick="selectFeatureTag(this)">
                                            MIX
                                        </button>
                                        <button type="button" class="btn btn-outline-secondary btn-sm feature-tag-btn" data-value="AIFILL" onclick="selectFeatureTag(this)">
                                            AIFILL
                                        </button>
                                        <button type="button" class="btn btn-outline-secondary btn-sm feature-tag-btn" data-value="RETOUCH" onclick="selectFeatureTag(this)">
                                            RETOUCH
                                        </button>
                                        <button type="button" class="btn btn-outline-secondary btn-sm feature-tag-btn" data-value="CHANGE" onclick="selectFeatureTag(this)">
                                            CHANGE
                                        </button>
                                        <button type="button" class="btn btn-outline-secondary btn-sm feature-tag-btn" data-value="IMGT-MODEL" onclick="selectFeatureTag(this)">
                                            IMGT-MODEL
                                        </button>
                                        <button type="button" class="btn btn-outline-secondary btn-sm feature-tag-btn" data-value="IMGT-STAGE" onclick="selectFeatureTag(this)">
                                            IMGT-STAGE
                                        </button>
                                        <button type="button" class="btn btn-outline-secondary btn-sm feature-tag-btn" data-value="IMGT-BEAUTIFY" onclick="selectFeatureTag(this)">
                                            IMGT-BEAUTIFY
                                        </button>
                                        <button type="button" class="btn btn-outline-secondary btn-sm feature-tag-btn" data-value="RnD" onclick="selectFeatureTag(this)">
                                            RnD
                                        </button>
                                    </div>
                                    <input type="hidden" id="feature" value="AIBG">
                                    <small class="text-muted">Click to select a feature tag ‚Ä¢ <a href="#feature-tags-help" class="text-decoration-none">üìñ Feature tags explained</a></small>
                                </div>
                            </div>
                        </div>

                        <!-- Creative Tags Section -->
                        <div id="creativeTagsSection">

                            <!-- HOOK -->
                            <div class="mb-3">
                                <label for="hook" class="form-label">
                                    <i class="fas fa-fish"></i> HOOK
                                </label>
                                <div class="row">
                                    <div class="col-md-6">
                                        <select class="form-select" id="hook" onchange="updateHookText(); updatePreview()">
                                            <option value="any" selected>any</option>
                                            <option value="come">come</option>
                                            <option value="UGC">UGC</option>
                                            <option value="text">text</option>
                                            <option value="emoji">emoji</option>
                                            <option value="nonono">nonono</option>
                                            <option value="ASMR">ASMR</option>
                                            <option value="AIUGC">AIUGC</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6">
                                        <input type="text" class="form-control" id="hookTextInput" placeholder="such as Turn your photo into a video" 
                                               onchange="formatInputToCamelCase('hookTextInput')" oninput="formatInputToCamelCase('hookTextInput')" style="display: none;">
                                        <input type="text" class="form-control" id="hookUgcInput" placeholder="such as arline778(optional)" 
                                               onchange="updatePreview()" oninput="updatePreview()" style="display: none;">
                                    </div>
                                </div>
                            </div>

                            <!-- VO (Voice Over) -->
                            <div class="mb-3">
                                <label for="voiceOver" class="form-label">
                                    <i class="fas fa-microphone"></i> VO (Voice Over)
                                </label>
                                <div class="row">
                                    <div class="col-md-3">
                                        <select class="form-select" id="voiceOver" onchange="updateVoiceText(); updatePreview()">
                                            <option value="any" selected>any</option>
                                            <option value="null">null</option>
                                            <option value="tom">Tom</option>
                                            <option value="doja">Doja</option>
                                            <option value="chris">Chris</option>
                                            <option value="human">Human</option>
                                            <option value="custom">Custom voice</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <input type="text" class="form-control" id="voiceName" placeholder="such as Snooypdog" 
                                               onchange="formatInputToCamelCase('voiceName')" oninput="formatInputToCamelCase('voiceName')" style="display: none;">
                                    </div>
                                    <div class="col-md-6">
                                        <input type="text" class="form-control" id="voScript" placeholder="such as Don't take bad pictures(optional)" 
                                               onchange="formatInputToCamelCase('voScript')" oninput="updatePreviewDebounced()">
                                    </div>
                                </div>
                            </div>

                            <!-- MUSIC -->
                            <div class="mb-3">
                                <label for="music" class="form-label">
                                    <i class="fas fa-music"></i> MUSIC
                                </label>
                                <div class="row">
                                    <div class="col-md-6">
                                        <select class="form-select" id="music" onchange="updateMusicText(); updatePreview()">
                                            <option value="any" selected>any</option>
                                            <option value="lofi">lofi(ambiance sound)</option>
                                            <option value="kpop">kpop</option>
                                            <option value="hiphop">hiphop</option>
                                            <option value="90s">90s</option>
                                            <option value="trend">trend</option>
                                            <option value="custom">Custom song name</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6">
                                        <input type="text" class="form-control" id="musicCustom" placeholder="such as last christmas" 
                                               onchange="formatInputToCamelCase('musicCustom')" oninput="updatePreviewDebounced()" style="display: none;">
                                    </div>
                                </div>
                            </div>

                            <!-- DIM (Dimension/Format) -->
                            <div class="mb-3">
                                <label for="dimension" class="form-label">
                                    <i class="fas fa-expand"></i> DIM (Dimension)
                                </label>
                                <select class="form-select" id="dimension" onchange="updatePreview()">
                                    <option value="">Select dimension...</option>
                                    <option value="PO" selected>PO - Portrait (9:16)</option>
                                    <option value="SQ">SQ - Square (1:1)</option>
                                    <option value="LS">LS - Landscape (16:9)</option>
                                </select>
                                <small class="text-muted">Always specify aspect ratio</small>
                            </div>

                            <!-- Language -->
                            <div class="mb-3">
                                <label for="language" class="form-label">
                                    <i class="fas fa-globe"></i> Language
                                </label>
                                <select class="form-select" id="language" onchange="updatePreview()">
                                    <option value="">Select language...</option>
                                    <!-- Priority languages (ISO 639-1 codes) -->
                                    <option value="en" selected>en - English</option>
                                    <option value="fr">fr - French</option>
                                    <option value="pt">pt - Portuguese (Brazilian)</option>
                                    <option value="es">es - Spanish</option>
                                    <option value="ja">ja - Japanese</option>
                                    <option value="ko">ko - Korean</option>
                                    <!-- Other languages (alphabetical by ISO 639-1 code) -->
                                    <option value="ar">ar - Arabic</option>
                                    <option value="zh">zh - Chinese</option>
                                    <option value="de">de - German</option>
                                    <option value="hi">hi - Hindi</option>
                                    <option value="id">id - Indonesian</option>
                                    <option value="it">it - Italian</option>
                                    <option value="ms">ms - Malay</option>
                                    <option value="nl">nl - Dutch</option>
                                    <option value="pl">pl - Polish</option>
                                    <option value="th">th - Thai</option>
                                    <option value="tl">tl - Filipino</option>
                                    <option value="tr">tr - Turkish</option>
                                    <option value="vi">vi - Vietnamese</option>
                                </select>
                                <small class="text-muted">
                                    Content language ‚Ä¢ 
                                    <a href="#language-codes-help" class="text-decoration-none" onclick="toggleLanguageCodesHelp()">
                                        <i class="fas fa-info-circle"></i> ISO 639-1 codes
                                    </a> ‚Ä¢ 
                                    <a href="/language-mapping" target="_blank" class="text-decoration-none">
                                        <i class="fas fa-external-link-alt"></i> Full mapping
                                    </a>
                                </small>
                                
                                <!-- Collapsible Language Codes Help -->
                                <div class="collapse mt-2" id="languageCodesHelp">
                                    <div class="alert alert-info" style="font-size: 0.85em;">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <strong>üìù Key Changes:</strong><br>
                                                <small>
                                                    <span class="badge bg-secondary me-1">JP</span>‚Üí<span class="badge bg-primary me-2">ja</span>
                                                    <span class="badge bg-secondary me-1">KR</span>‚Üí<span class="badge bg-primary me-2">ko</span><br>
                                                    <span class="badge bg-secondary me-1">BR</span>‚Üí<span class="badge bg-primary me-2">pt</span>
                                                    <span class="badge bg-secondary me-1">SA</span>‚Üí<span class="badge bg-primary me-2">ar</span>
                                                </small>
                                            </div>
                                            <div class="col-md-6">
                                                <strong>üí° ISO 639-1 Standard:</strong><br>
                                                <small>
                                                    Now using international 2-letter language codes (lowercase). 
                                                    Old codes still work during transition.
                                                </small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>


                    </form>
                </div>
            </div>
        </div>
            </div>
            
            <!-- Right: Live Preview -->
            <div class="col-lg-4">
                <div class="sticky-top" style="top: 20px;">
                    <!-- Premium Preview Container -->
                    <div class="p-4 preview-name-container" style="
                        background: linear-gradient(135deg, #6bd0ff 0%, #249dee 100%);
                        border: 3px solid transparent;
                        border-radius: 20px;
                        box-shadow: 0 10px 30px rgba(107, 208, 255, 0.3), 0 0 20px rgba(36, 157, 238, 0.2);
                        position: relative;
                        overflow: hidden;
                        animation: previewShimmer 3s ease-in-out infinite;
                        margin-bottom: 20px;
                    ">
                        <!-- Animated background overlay -->
                        <div style="
                            position: absolute;
                            top: -50%;
                            left: -50%;
                            width: 200%;
                            height: 200%;
                            background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.1) 50%, transparent 70%);
                            animation: previewShine 2.5s ease-in-out infinite;
                            pointer-events: none;
                        "></div>
                        
                        <h3 style="
                            color: white;
                            font-weight: 700;
                            font-size: 1.3em;
                            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
                            margin-bottom: 20px;
                            display: flex;
                            align-items: center;
                            gap: 10px;
                            justify-content: center;
                        ">
                            <span style="font-size: 1.2em;">üöÄ</span>
                            <span>New Creative Name</span>
                            <span style="font-size: 1.2em;">üöÄ</span>
                        </h3>
                        
                        <div class="generated-name" id="liveGeneratedName" style="
                            background: rgba(255, 255, 255, 0.95);
                            border: 3px solid rgba(255,255,255,0.3);
                            border-radius: 15px;
                            padding: 20px;
                            margin-bottom: 15px;
                        ">
                            <div class="name-text" id="liveNameText" style="
                                color: #333;
                                font-weight: 600;
                                font-size: 1.2em;
                                word-break: break-all;
                                margin-bottom: 15px;
                                line-height: 1.4;
                            ">internal_[filename]_HOOK-any_VO-any_MUSIC-any_PO_AIBG_en</div>
                            <button class="copy-btn" id="liveCopyBtn" onclick="copyLiveName()" style="
                                background: linear-gradient(135deg, #6bd0ff, #249dee);
                                color: white;
                                border: none;
                                padding: 10px 20px;
                                border-radius: 10px;
                                font-weight: 600;
                                box-shadow: 0 4px 15px rgba(107, 208, 255, 0.3);
                                transition: all 0.3s ease;
                            ">
                                <i class="fas fa-copy"></i> Copy to Clipboard
                            </button>
                        </div>
                        
                        <!-- Mock preview with ID/creator/date -->
                        <div style="
                            background: rgba(255,255,255,0.15);
                            border-radius: 12px;
                            padding: 15px;
                        ">
                            <div style="
                                color: rgba(255,255,255,0.9);
                                font-weight: 500;
                                font-size: 0.9em;
                                margin-bottom: 8px;
                                display: flex;
                                align-items: center;
                                gap: 5px;
                            ">
                                <i class="fas fa-info-circle"></i>
                                <span>Preview after upload</span>
                            </div>
                            <div style="
                                color: white;
                                font-size: 0.9em;
                                word-break: break-all;
                                font-family: monospace;
                                background: rgba(0,0,0,0.2);
                                padding: 10px;
                                border-radius: 8px;
                                line-height: 1.4;
                            " id="mockPreview">
                                12345_John_internal_[filename]_HOOK-any_VO-any_MUSIC-any_PO_AIBG_en_19092025
                            </div>
                        </div>
                        
                        <!-- Quick Actions -->
                        <div class="mt-3 text-center">
                            <button class="btn btn-sm" onclick="clearForm()" style="
                                background: rgba(255,255,255,0.2);
                                color: white;
                                border: 2px solid rgba(255,255,255,0.3);
                                border-radius: 10px;
                                font-weight: 600;
                                padding: 8px 16px;
                                transition: all 0.3s ease;
                            ">
                                <i class="fas fa-refresh"></i> Reset Form
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Iteration Naming Section -->
        <div class="section">
            <h3><i class="fas fa-repeat"></i> üîÑ Creative Iteration Generator</h3>
            <p class="text-muted mb-4">
                Generate iteration names for winning creatives. Paste an existing AdManage filename and get the next iteration automatically.
            </p>
            
            <div class="row">
                <div class="col-lg-8">
                    <div class="mb-3">
                        <label for="originalFilename" class="form-label">
                            <i class="fas fa-file"></i> Original AdManage Filename
                        </label>
                        <input type="text" class="form-control form-control-lg" id="originalFilename" 
                               placeholder="such as 12345_Jiali_internal_RedBottle_ANIM_en"
                               onchange="generateIteration()" oninput="generateIteration()">
                        <small class="text-muted">Paste the complete filename from AdManage</small>
                    </div>
                    
                    <div class="mb-3">
                        <label for="iterationNumber" class="form-label">
                            <i class="fas fa-hashtag"></i> Iteration Number
                        </label>
                        <input type="number" class="form-control" id="iterationNumber" 
                               value="1" min="1" max="99"
                               onchange="generateIteration()" oninput="generateIteration()">
                        <small class="text-muted">Which iteration version (1, 2, 3...)</small>
                    </div>
                </div>
                
                <div class="col-lg-4">
                    <div class="sticky-top" style="top: 20px;">
                        <h5><i class="fas fa-magic"></i> Generated Iteration</h5>
                        <div class="generated-name" style="background: linear-gradient(135deg, #28a745, #20c997); color: white;">
                            <div class="name-text" id="iterationResult" style="color: white;">
                                12345_Jiali_internal_RedBottle-ITE-1_ANIM_en
                            </div>
                            <button class="copy-btn" id="iterationCopyBtn" onclick="copyIterationName()" style="background: rgba(255,255,255,0.2);">
                                <i class="fas fa-copy"></i> Copy Iteration
                            </button>
                        </div>
                        
                        <div class="mt-3">
                            <div class="preview-label">
                                <i class="fas fa-info-circle"></i> How it works
                            </div>
                            <div class="preview-text" style="font-size: 0.85em;">
                                Adds -ITE-X after the filename:<br>
                                <code>MyBlueHoodie-1</code> ‚Üí <code>MyBlueHoodie-1-ITE-1</code>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Name Validation Section -->
        <div class="section">
            <h3><i class="fas fa-check-circle"></i> ‚úÖ Creative Name Validator</h3>
            <p class="text-muted mb-4">
                Paste any creative name to validate if it follows our naming convention. Works with both formats: with or without ID/creator/date.
            </p>
            
            <div class="row">
                <div class="col-lg-8">
                    <div class="mb-3">
                        <label for="nameToValidate" class="form-label">
                            <i class="fas fa-clipboard-check"></i> Creative Name to Validate
                        </label>
                        <input type="text" class="form-control form-control-lg" id="nameToValidate" 
                               placeholder="internal_BlueGhostMannequin-5_HOOK-text_VO-null_MUSIC-lofi_PO_RnD_en"
                               onchange="validateCreativeName()" oninput="validateCreativeName()">
                        <small class="text-muted">Paste any creative name to check if it's valid</small>
                    </div>
                    
                    <!-- Validation Results -->
                    <div id="validationResults" class="mt-3" style="display: none;">
                        <div class="alert" id="validationAlert" style="border-radius: 15px; border: 2px solid;">
                            <div class="d-flex align-items-center">
                                <span id="validationIcon" style="font-size: 1.5em; margin-right: 15px;"></span>
                                <div>
                                    <h5 id="validationTitle" class="mb-1"></h5>
                                    <p id="validationMessage" class="mb-0"></p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Detailed Breakdown -->
                        <div id="validationBreakdown" class="mt-3" style="display: none;">
                            <h6><i class="fas fa-list-ul"></i> Validation Breakdown</h6>
                            <div class="row">
                                <div class="col-md-6">
                                    <div id="structureValidation"></div>
                                </div>
                                <div class="col-md-6">
                                    <div id="contentValidation"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-lg-4">
                    <div class="sticky-top" style="top: 20px;">
                        <h5><i class="fas fa-info-circle"></i> Validation Rules</h5>
                        <div class="preview-text" style="font-size: 0.85em; line-height: 1.6;">
                            <strong>‚úÖ Valid Formats:</strong><br>
                            <code>10946_Jiali_internal_Stanley-1_HOOK-comehere_VO-tom_MUSIC-lofi_PO_ANIM_en_18092025</code><br><br>
                            <code>28022_Jiali_freelancer-Jeremy_RedBottle-1_HOOK-come_VO-tom_MUSIC-any_PO_AIBG_en_19092025</code><br><br>
                            <code>11020_Kaja_internal-RedBottle_-_-_-_-_AIBG_EN_06092025</code><br><br>
                            <strong>üìã Required Parts:</strong><br>
                            ‚Ä¢ Creator type: internal_ or freelancer-xxx_ or ramdam-xxx_ or influencer-xxx_<br>
                            ‚Ä¢ Creative name with optional number<br>
                            ‚Ä¢ All 4 tags: HOOK-xxx, VO-xxx, MUSIC-xxx, DIM (or empty "-")<br>
                            ‚Ä¢ Feature tag (AIBG, STORY, LOGO, etc.)<br>
                            ‚Ä¢ Language code (EN, FR, PT, etc. or lowercase)<br><br>
                            <strong>üîç Optional Parts:</strong><br>
                            ‚Ä¢ ID number (for AdManage format)<br>
                            ‚Ä¢ Creator name (combined with type for non-internal)<br>
                            ‚Ä¢ Date (DDMMYYYY format)<br>
                            ‚Ä¢ Empty tags "-" (for compact format)
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Creative Naming Structure Section -->
        <div class="section">
            <h3><i class="fas fa-bolt"></i> üìå Creative Naming Structure</h3>
            <div class="alert alert-info">
                <div class="format-display">
                    <strong>Format:</strong> [id]_[creator]_[creator-type]_[filename]_[extra 4 tags]_[feature]_[language]_[date]
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <strong>Critical Rules:</strong>
                        <ul class="mb-0">
                            <li><code>_</code> = separate <strong>main fields</strong></li>
                            <li><code>-</code> = separate <strong>details inside tags</strong></li>
                            <li><strong>ID, Creator, Date</strong> auto-added by Admanage</li>
                            <li><strong>All 4 tags</strong>: HOOK ‚Üí VO ‚Üí MUSIC ‚Üí DIM (always applied)</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <strong>Examples:</strong><br>
                        <div class="tag-example">
                            internal_RedBottle_HOOK-come-text_VO-tom_MUSIC-rapbeat_PO_AIBG_en
                        </div>
                        <div class="tag-example">
                            internal_RedBottle_HOOK-any_VO-any_MUSIC-any_PO_AIBG_en
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Feature Tags Help Section -->
        <div class="section" id="feature-tags-help">
            <h3><i class="fas fa-info-circle"></i> üìñ Feature Tags Explained</h3>
            <div class="alert alert-light border">
                <p class="mb-3">Each feature tag represents a specific Photoroom tool or capability:</p>
                
                <div class="row">
                    <div class="col-md-6">
                        <h6><i class="fas fa-star text-primary"></i> Core Features</h6>
                        <div class="tag-core">AIBG</div>
                        <small class="text-muted d-block mb-2">AI background ads</small>
                        
                        <div class="tag-core">STORY</div>
                        <small class="text-muted d-block mb-2">AI Instagram Story ads</small>
                        
                        <div class="tag-core">LOGO</div>
                        <small class="text-muted d-block mb-2">AI logo ads</small>
                        
                        <div class="tag-core">ANIM</div>
                        <small class="text-muted d-block mb-2">Animated Design</small>
                        
                        <div class="tag-core">MIX</div>
                        <small class="text-muted d-block mb-2">Multiple features combined</small>
                    </div>
                    
                    <div class="col-md-6">
                        <h6><i class="fas fa-magic text-success"></i> Other Tools</h6>
                        <div class="tag-tools">AIFILL</div>
                        <small class="text-muted d-block mb-2">AI Fill tool</small>
                        
                        <div class="tag-tools">RETOUCH</div>
                        <small class="text-muted d-block mb-2">Photo retouching</small>
                        
                        <div class="tag-tools">CHANGE</div>
                        <small class="text-muted d-block mb-2">Describe a Change feature</small>
                        
                        <div class="tag-experimental">RnD</div>
                        <small class="text-muted d-block mb-2">üß™ Experimental new feature, not yet in existing tags</small>
                    </div>
                </div>
                
                <div class="mt-4">
                    <h6><i class="fas fa-layer-group text-info"></i> Image Transformation (IMGT) Suite</h6>
                    <div class="d-flex flex-wrap gap-2 align-items-center">
                        <div class="tag-imgt">IMGT-MODEL</div>
                        <small class="text-muted">Virtual model ‚Ä¢</small>
                        
                        <div class="tag-imgt">IMGT-STAGE</div>
                        <small class="text-muted">Product staging ‚Ä¢</small>
                        
                        <div class="tag-imgt">IMGT-BEAUTIFY</div>
                        <small class="text-muted">Product beautifier</small>
                    </div>
                    <small class="text-muted d-block mt-2">
                        <i class="fas fa-lightbulb"></i> <strong>IMGT</strong> is the umbrella category for image transformation tools
                    </small>
                </div>
            </div>
        </div>

        <!-- Help Section -->
{% endblock %}

{% block scripts %}
    <script>
        // Global counter for creative names - magical auto-increment
        let creativeNameCounter = 1;
        let usedCreativeNames = new Set();
        
        // Cache DOM elements for better performance
        let creatorTypeEl, creatorNameEl, filenameEl, languageEl, featureEl, hookEl, hookTextEl, hookUgcEl,
            voiceOverEl, voiceNameEl, voScriptEl, musicEl, musicCustomEl, dimensionEl, creativeNumberEl,
            liveNameEl, mockPreviewEl;
        
        // Generate date once per session
        const TODAY_YYYYMMDD = (() => {
            const d = new Date();
            const y = d.getFullYear();
            const m = String(d.getMonth()+1).padStart(2,'0');
            const day = String(d.getDate()).padStart(2,'0');
            return `${day}${m}${y}`;
        })();
        
        // Debounce preview updates
        let rafId = null;
        function updatePreviewDebounced() {
            if (rafId) cancelAnimationFrame(rafId);
            rafId = requestAnimationFrame(updatePreview);
        }
        
        function initEls() {
            creatorTypeEl = document.getElementById('creatorType');
            creatorNameEl = document.getElementById('creatorName');
            filenameEl = document.getElementById('filename');
            languageEl = document.getElementById('language');
            featureEl = document.getElementById('feature');
            hookEl = document.getElementById('hook');
            hookTextEl = document.getElementById('hookTextInput');
            hookUgcEl = document.getElementById('hookUgcInput');
            voiceOverEl = document.getElementById('voiceOver');
            voiceNameEl = document.getElementById('voiceName');
            voScriptEl = document.getElementById('voScript');
            musicEl = document.getElementById('music');
            musicCustomEl = document.getElementById('musicCustom');
            dimensionEl = document.getElementById('dimension');
            creativeNumberEl = document.getElementById('creativeNumber');
            liveNameEl = document.getElementById('liveNameText');
            mockPreviewEl = document.getElementById('mockPreview');
        }
        
        
        
        // Always show creative tags section (removed toggle functionality)
        function showCreativeTags() {
            const creativeTagsSection = document.getElementById('creativeTagsSection');
            creativeTagsSection.style.display = 'block';
            updatePreview();
        }
        
        // Enhanced function to format text to PascalCase with smart abbreviation
        function formatToPascalCase(text) {
            if (!text) return '';
            
            // Remove forbidden filename characters: ! " # $ % & ' ( ) * + , / : : ; < = > ? [ \ ] ^ ` { | } ~
            const forbiddenChars = /[!"#$%&'()*+,/:;<=>?[\\\]^`{|}~]/g;
            const cleanedText = text.replace(forbiddenChars, '');
            
            // First, split by spaces and clean up
            let words = cleanedText.trim().split(/\s+/);
            
            // If there's only one word, check for camelCase transitions
            if (words.length === 1 && words[0].length > 1) {
                // Split camelCase words (such as "dirtyKitchen" ‚Üí ["dirty", "Kitchen"])
                words = words[0].split(/(?=[A-Z])/).filter(word => word.length > 0);
            }
            
            // Simple PascalCase formatting
            const formattedWords = words.map(word => {
                if (word.length === 0) return '';
                return word.charAt(0).toUpperCase() + word.slice(1).toLowerCase();
            });
            
            return formattedWords.join('');
        }

        // Function to format creative name for input field (capitalize first letters, keep spaces)
        function formatCreativeName() {
            const input = filenameEl;
            const original = input.value;
            
            // Strip any typed numeric suffix permanently on blur
            const withoutNum = original.replace(/-\d+\s*$/, '');
            
            // Simple Title Case without altering spaces in the field
            const formatted = withoutNum.replace(/\b\w/g, l => l.toUpperCase());
            
            if (formatted !== original) {
                input.value = formatted;
            }
            
            updatePreview();
        }


        // Function to format any input field to CamelCase
        function formatInputToCamelCase(inputId) {
            const input = document.getElementById(inputId);
            if (!input) return;
            
            const cursorPos = input.selectionStart;
            const originalValue = input.value;
            const formatted = formatToPascalCase(originalValue);
            
            if (originalValue !== formatted) {
                input.value = formatted;
                
                const newPos = Math.min(cursorPos, formatted.length);
                setTimeout(() => {
                    input.setSelectionRange(newPos, newPos);
                }, 0);
            }
            
            updatePreview();
        }

        // Function to handle hook text input visibility
        function updateHookText() {
            const hookSelect = document.getElementById('hook');
            const hookTextInput = document.getElementById('hookTextInput');
            const hookUgcInput = document.getElementById('hookUgcInput');
            
            // Hide both inputs first
            hookTextInput.style.display = 'none';
            hookUgcInput.style.display = 'none';
            hookTextInput.value = '';
            hookUgcInput.value = '';
            
            if (hookSelect.value === 'text') {
                hookTextInput.style.display = 'block';
            } else if (hookSelect.value === 'UGC') {
                hookUgcInput.style.display = 'block';
            }
        }

        // Function to handle voice dropdown changes
        function updateVoiceText() {
            const voiceSelect = document.getElementById('voiceOver');
            const voiceNameInput = document.getElementById('voiceName');
            
            if (voiceSelect.value === 'custom') {
                voiceNameInput.style.display = 'block';
            } else {
                voiceNameInput.style.display = 'none';
                voiceNameInput.value = '';
            }
        }

        // Function to handle music custom input visibility
        function updateMusicText() {
            const musicSelect = document.getElementById('music');
            const musicCustomInput = document.getElementById('musicCustom');
            
            if (musicSelect.value === 'custom') {
                musicCustomInput.style.display = 'block';
            } else {
                musicCustomInput.style.display = 'none';
                musicCustomInput.value = '';
            }
        }

        function updatePreview() {
            const creatorType = creatorTypeEl.value || '[creator-type]';
            const creatorName = creatorNameEl.value;
            const rawFilename = filenameEl.value || '[filename]';
            const language = languageEl.value || '[language]';
            const feature = featureEl.value;
            
            // Format filename for preview (remove spaces, PascalCase) but don't modify the input field
            let filename = rawFilename;
            if (rawFilename && rawFilename !== '[filename]') {
                // ALWAYS ignore user-typed suffix like "-1"
                const base = formatToPascalCase(rawFilename.replace(/-\d+\s*$/, '').trim());
                
                // Always use the control's number
                const num = Math.min(Math.max(parseInt(creativeNumberEl.value) || 1, 1), 999);
                filename = `${base}-${num}`;
            }
            
            // Build creator type part
            let creatorTypePart = '';
            if (creatorType !== '[creator-type]') {
                if (creatorType === 'internal') {
                    creatorTypePart = `${creatorType}_${filename}`;
                } else if (creatorName) {
                    creatorTypePart = `${creatorType}-${creatorName}_${filename}`;
                } else {
                    creatorTypePart = `${creatorType}-[name]_${filename}`;
                }
            } else {
                creatorTypePart = `[creator-type]_${filename}`;
            }
            
            let preview = creatorTypePart;
            
            // Always apply full creative tags (removed placeholder option)
            const hook = hookEl.value || '[hook]';
            const hookTextInput = hookTextEl.value;
            const voiceName = voiceNameEl.value || '[voice]';
            const voScript = voScriptEl.value;
            const music = musicEl.value || '[music]';
            const musicCustom = musicCustomEl.value;
            const dimension = dimensionEl.value || '[dim]';
            
            // Build HOOK
            const hookUgcInput = hookUgcEl.value;
            let hookPart = `HOOK-${hook}`;
            if (hook === 'text' && hookTextInput) {
                const formattedText = formatToPascalCase(hookTextInput);
                hookPart = `HOOK-text-${formattedText}`;
            } else if (hook === 'UGC' && hookUgcInput) {
                hookPart = `HOOK-ugc-${hookUgcInput.trim()}`;
            }
            
            // Build VO
            const voiceOver = voiceOverEl.value;
            let voiceToUse = voiceOver === 'custom' ? voiceName : voiceOver;
            let voPart = `VO-${voiceToUse || '[voice]'}`;
            if (voScript && voiceOver !== 'null') {
                const formattedScript = formatToPascalCase(voScript);
                voPart += `-${formattedScript}`;
            }
            
            // Build MUSIC
            let musicPart = 'MUSIC-';
            if (music === 'custom' && musicCustom) {
                const formattedMusicName = formatToPascalCase(musicCustom);
                musicPart += formattedMusicName;
            } else {
                musicPart += music;
            }
            
            // Build tags block
            const tagsBlock = `${hookPart}_${voPart}_${musicPart}_${dimension}`;
            preview += `_${tagsBlock}`;
            
            // Add feature tag if selected
            if (feature) {
                preview += `_${feature}`;
            }
            
            // Add language
            preview += `_${language}`;
            
            // Update live display
            liveNameEl.textContent = preview;
            
            // Update mock preview with sample ID/creator/date (using cached date)
            const fixedId = 12345;
            const mockPreview = `${fixedId}_Jiali_${preview}_${TODAY_YYYYMMDD}`;
            mockPreviewEl.textContent = mockPreview;
        }
        
        // Update creator type change handler
        function updateCreatorTypeFields() {
            const creatorType = creatorTypeEl.value;
            const creatorNameDiv = document.getElementById('creatorNameDiv');
            const creatorNameLabel = document.getElementById('creatorNameLabel');
            
            if (creatorType && creatorType !== 'internal') {
                creatorNameDiv.style.display = 'block';
                
                // Update label text based on creator type
                let labelText = 'Creator Name';
                switch(creatorType) {
                    case 'freelancer':
                        labelText = 'Freelancer Creator Name';
                        break;
                    case 'ramdam':
                        labelText = 'Ramdam Creator Name';
                        break;
                    case 'influencer':
                        labelText = 'Influencer Creator Name';
                        break;
                    default:
                        labelText = 'Creator Name';
                }
                creatorNameLabel.innerHTML = `<i class="fas fa-user"></i> ${labelText}`;
                
            } else {
                creatorNameDiv.style.display = 'none';
                creatorNameEl.value = '';
            }
            updatePreviewDebounced();
        }
        
        // Feature tag selection function
        function selectFeatureTag(button) {
            // Remove active class from all buttons
            document.querySelectorAll('.feature-tag-btn').forEach(btn => {
                btn.classList.remove('active', 'btn-outline-primary');
                btn.classList.add('btn-outline-secondary');
            });
            
            // Add active class to clicked button
            button.classList.remove('btn-outline-secondary');
            button.classList.add('active', 'btn-outline-primary');
            
            // Update hidden input value
            document.getElementById('feature').value = button.dataset.value;
            
            // Update preview
            updatePreview();
        }
        
        function copyLiveName() {
            const nameText = document.getElementById('liveNameText').textContent;
            navigator.clipboard.writeText(nameText).then(function() {
                const copyBtn = document.getElementById('liveCopyBtn');
                const originalText = copyBtn.innerHTML;
                copyBtn.innerHTML = '<i class="fas fa-check"></i> Copied!';
                copyBtn.classList.add('copied');
                
                setTimeout(() => {
                    copyBtn.innerHTML = originalText;
                    copyBtn.classList.remove('copied');
                }, 2000);
            }).catch(function(err) {
                console.error('Could not copy text: ', err);
                alert('Could not copy to clipboard. Please copy manually: ' + nameText);
            });
        }

        // Function to generate iteration name
        function generateIteration() {
            const originalFilename = document.getElementById('originalFilename').value.trim();
            const iterationNumber = document.getElementById('iterationNumber').value || 1;
            const resultElement = document.getElementById('iterationResult');
            
            if (!originalFilename) {
                resultElement.textContent = '12345_Jiali_internal_RedBottle-ITE-1_ANIM_en';
                return;
            }
            
            // Parse the AdManage filename format: [id]_[creator]_[creator-type]_[filename]_[HOOK-‚Ä¶_VO-‚Ä¶_MUSIC-‚Ä¶_DIM]_[feature]_[language]_[date]
            const parts = originalFilename.split('_');
            
            if (parts.length < 4) {
                resultElement.textContent = 'Invalid filename format';
                return;
            }
            
            // Find the filename part (4th part, index 3)
            let filenameIndex = 3; // Filename is at index 3
            let filenamePart = parts[filenameIndex];
            
            // Check if the filename already has an iteration
            const iterationRegex = /-ITE-\d+/;
            if (iterationRegex.test(filenamePart)) {
                // Remove existing iteration
                filenamePart = filenamePart.replace(iterationRegex, '');
            }
            
            // Add the new iteration
            const newFilename = `${filenamePart}-ITE-${iterationNumber}`;
            
            // Reconstruct the filename
            const newParts = [...parts];
            newParts[filenameIndex] = newFilename;
            const iterationFilename = newParts.join('_');
            
            resultElement.textContent = iterationFilename;
        }

        // Function to copy iteration name
        function copyIterationName() {
            const nameText = document.getElementById('iterationResult').textContent;
            
            if (nameText === 'Invalid filename format') {
                alert('Please enter a valid filename first');
                return;
            }
            
            navigator.clipboard.writeText(nameText).then(function() {
                const copyBtn = document.getElementById('iterationCopyBtn');
                const originalText = copyBtn.innerHTML;
                copyBtn.innerHTML = '<i class="fas fa-check"></i> Copied!';
                copyBtn.classList.add('copied');
                
                setTimeout(() => {
                    copyBtn.innerHTML = originalText;
                    copyBtn.classList.remove('copied');
                }, 2000);
            }).catch(function(err) {
                console.error('Could not copy text: ', err);
                alert('Could not copy to clipboard. Please copy manually: ' + nameText);
            });
        }
        
        function clearForm() {
            document.getElementById('nameGeneratorForm').reset();
            document.getElementById('creatorNameDiv').style.display = 'none';
            document.getElementById('creativeTagsSection').style.display = 'block';
            
            // Hide conditional inputs
            document.getElementById('hookTextInput').style.display = 'none';
            document.getElementById('hookUgcInput').style.display = 'none';
            document.getElementById('voiceName').style.display = 'none';
            document.getElementById('musicCustom').style.display = 'none';
            
            // Set default values
            document.getElementById('creatorType').value = 'internal';
            document.getElementById('hook').value = 'any';
            document.getElementById('voiceOver').value = 'any';
            document.getElementById('music').value = 'any';
            document.getElementById('dimension').value = 'PO';
            document.getElementById('feature').value = 'AIBG';
            document.getElementById('language').value = 'en';
            document.getElementById('creativeNumber').value = '1';
            
            // Reset feature tag buttons
            document.querySelectorAll('.feature-tag-btn').forEach(btn => {
                btn.classList.remove('active', 'btn-outline-primary');
                btn.classList.add('btn-outline-secondary');
            });
            // Set AIBG as active
            const aibgBtn = document.querySelector('[data-value="AIBG"]');
            if (aibgBtn) {
                aibgBtn.classList.remove('btn-outline-secondary');
                aibgBtn.classList.add('active', 'btn-outline-primary');
            }
            
            updatePreview();
            
            // Remove validation classes
            document.querySelectorAll('.is-invalid').forEach(el => {
                el.classList.remove('is-invalid');
            });
        }
        
        // Toggle language codes help section
        function toggleLanguageCodesHelp() {
            const helpSection = document.getElementById('languageCodesHelp');
            if (helpSection.classList.contains('show')) {
                helpSection.classList.remove('show');
            } else {
                helpSection.classList.add('show');
            }
        }
        
        // Creative Name Validation Function
        function validateCreativeName() {
            const input = document.getElementById('nameToValidate');
            const nameToValidate = input.value.trim();
            const resultsDiv = document.getElementById('validationResults');
            const breakdownDiv = document.getElementById('validationBreakdown');
            const alertDiv = document.getElementById('validationAlert');
            const iconSpan = document.getElementById('validationIcon');
            const titleSpan = document.getElementById('validationTitle');
            const messageSpan = document.getElementById('validationMessage');
            const structureDiv = document.getElementById('structureValidation');
            const contentDiv = document.getElementById('contentValidation');
            
            if (!nameToValidate) {
                resultsDiv.style.display = 'none';
                return;
            }
            
            const validation = validateCreativeNameStructure(nameToValidate);
            
            // Show results
            resultsDiv.style.display = 'block';
            breakdownDiv.style.display = validation.isValid ? 'block' : 'block';
            
            // Update main alert
            if (validation.isValid) {
                alertDiv.className = 'alert alert-success';
                iconSpan.textContent = '‚úÖ';
                titleSpan.textContent = 'Valid Creative Name';
                titleSpan.className = 'mb-1 text-success';
                messageSpan.textContent = validation.message;
                messageSpan.className = 'mb-0 text-success';
            } else {
                alertDiv.className = 'alert alert-danger';
                iconSpan.textContent = '‚ùå';
                titleSpan.textContent = 'Invalid Creative Name';
                titleSpan.className = 'mb-1 text-danger';
                messageSpan.textContent = validation.message;
                messageSpan.className = 'mb-0 text-danger';
            }
            
            // Update breakdown
            structureDiv.innerHTML = validation.structureBreakdown;
            contentDiv.innerHTML = validation.contentBreakdown;
        }
        
        // Comprehensive validation function
        function validateCreativeNameStructure(name) {
            const result = {
                isValid: false,
                message: '',
                structureBreakdown: '',
                contentBreakdown: ''
            };
            
            // Split by underscores
            const parts = name.split('_');
            
            // Check if it's AdManage format (with ID/creator/date) or basic format
            const isAdManageFormat = parts.length >= 9 && /^\d+$/.test(parts[0]) && /^\d{8}$/.test(parts[parts.length - 1]);
            const isAdManageCompactFormat = parts.length >= 8 && /^\d+$/.test(parts[0]) && /^\d{8}$/.test(parts[parts.length - 1]);
            const isBasicFormat = parts.length >= 7;
            
            let structureChecks = [];
            let contentChecks = [];
            
            if (isAdManageFormat) {
                // AdManage format: [id]_[creator]_[creator-type]_[filename]_[HOOK]_[VO]_[MUSIC]_[DIM]_[feature]_[language]_[date]
                structureChecks.push(checkStructure('Format', 'AdManage format (with ID/creator/date)', true));
                structureChecks.push(checkStructure('Parts count', `${parts.length} parts (expected 9-11)`, parts.length >= 9 && parts.length <= 11));
                
                // Check ID
                structureChecks.push(checkStructure('ID', `ID: ${parts[0]}`, /^\d+$/.test(parts[0])));
                
                // Check creator type and filename (index 2 and 3)
                const creatorType = parts[2];
                const filename = parts[3];
                const validCreatorTypes = ['internal', 'freelancer', 'ramdam', 'influencer'];
                
                if (creatorType === 'internal') {
                    // Internal format: internal_Stanley-1
                    structureChecks.push(checkStructure('Creator Type', creatorType, validCreatorTypes.includes(creatorType)));
                    structureChecks.push(checkStructure('Filename', filename, /^[A-Za-z0-9-]+$/.test(filename)));
                } else {
                    // Non-internal format: freelancer-Jeremy_RedBottle-1 (creator type + creator name in one part)
                    const hasValidCreatorType = validCreatorTypes.some(type => creatorType.startsWith(type + '-'));
                    structureChecks.push(checkStructure('Creator Type + Name', creatorType, hasValidCreatorType));
                    structureChecks.push(checkStructure('Filename', filename, /^[A-Za-z0-9-]+$/.test(filename)));
                }
                
                // Check tags (indices 4-7)
                const hookPart = parts[4];
                const voPart = parts[5];
                const musicPart = parts[6];
                const dimPart = parts[7];
                
                structureChecks.push(checkStructure('HOOK tag', hookPart, hookPart.startsWith('HOOK-')));
                structureChecks.push(checkStructure('VO tag', voPart, voPart.startsWith('VO-')));
                structureChecks.push(checkStructure('MUSIC tag', musicPart, musicPart.startsWith('MUSIC-')));
                structureChecks.push(checkStructure('DIM tag', dimPart, ['PO', 'SQ', 'LS'].includes(dimPart)));
                
                // Check feature tag (index 8)
                const feature = parts[8];
                const validFeatures = ['AIBG', 'STORY', 'LOGO', 'ANIM', 'MIX', 'AIFILL', 'RETOUCH', 'CHANGE', 'IMGT-MODEL', 'IMGT-STAGE', 'IMGT-BEAUTIFY', 'RnD'];
                structureChecks.push(checkStructure('Feature tag', feature, validFeatures.includes(feature)));
                
                // Check language (index 9)
                const language = parts[9];
                const validLanguages = ['EN', 'FR', 'PT', 'ES', 'JA', 'KO', 'AR', 'ZH', 'DE', 'HI', 'ID', 'IT', 'MS', 'NL', 'PL', 'TH', 'TL', 'TR', 'VI', 'en', 'fr', 'pt', 'es', 'ja', 'ko', 'ar', 'zh', 'de', 'hi', 'id', 'it', 'ms', 'nl', 'pl', 'th', 'tl', 'tr', 'vi'];
                structureChecks.push(checkStructure('Language', language, validLanguages.includes(language)));
                
                // Check date (last part)
                const date = parts[parts.length - 1];
                structureChecks.push(checkStructure('Date', date, /^\d{8}$/.test(date)));
                
                // Content validation
                contentChecks.push(validateHookContent(hookPart));
                contentChecks.push(validateVoiceOverContent(voPart));
                contentChecks.push(validateMusicContent(musicPart));
                
            } else if (isAdManageCompactFormat) {
                // AdManage compact format: [id]_[creator]_[creator-type-filename]_[empty]_[empty]_[empty]_[empty]_[feature]_[language]_[date]
                structureChecks.push(checkStructure('Format', 'AdManage compact format (with empty tags)', true));
                structureChecks.push(checkStructure('Parts count', `${parts.length} parts (expected 8-10)`, parts.length >= 8 && parts.length <= 10));
                
                // Check ID
                structureChecks.push(checkStructure('ID', `ID: ${parts[0]}`, /^\d+$/.test(parts[0])));
                
                // Check creator (index 1)
                structureChecks.push(checkStructure('Creator', parts[1], parts[1].length > 0));
                
                // Check creator-type-filename combination (index 2)
                const creatorTypeFilename = parts[2];
                const validCreatorTypes = ['internal', 'freelancer', 'ramdam', 'influencer'];
                const hasValidCreatorType = validCreatorTypes.some(type => creatorTypeFilename.startsWith(type + '-'));
                structureChecks.push(checkStructure('Creator Type + Filename', creatorTypeFilename, hasValidCreatorType));
                
                // Check empty tags (indices 3-6) - these should be just "-"
                for (let i = 3; i <= 6; i++) {
                    if (parts[i]) {
                        structureChecks.push(checkStructure(`Tag ${i-2}`, parts[i], parts[i] === '-'));
                    }
                }
                
                // Check feature tag (index 7)
                const feature = parts[7];
                const validFeatures = ['AIBG', 'STORY', 'LOGO', 'ANIM', 'MIX', 'AIFILL', 'RETOUCH', 'CHANGE', 'IMGT-MODEL', 'IMGT-STAGE', 'IMGT-BEAUTIFY', 'RnD'];
                structureChecks.push(checkStructure('Feature tag', feature, validFeatures.includes(feature)));
                
                // Check language (index 8) - can be uppercase or lowercase
                const language = parts[8];
                const validLanguages = ['EN', 'FR', 'PT', 'ES', 'JA', 'KO', 'AR', 'ZH', 'DE', 'HI', 'ID', 'IT', 'MS', 'NL', 'PL', 'TH', 'TL', 'TR', 'VI', 'en', 'fr', 'pt', 'es', 'ja', 'ko', 'ar', 'zh', 'de', 'hi', 'id', 'it', 'ms', 'nl', 'pl', 'th', 'tl', 'tr', 'vi'];
                structureChecks.push(checkStructure('Language', language, validLanguages.includes(language)));
                
                // Check date (last part)
                const date = parts[parts.length - 1];
                structureChecks.push(checkStructure('Date', date, /^\d{8}$/.test(date)));
                
                // Content validation for compact format (tags are empty)
                contentChecks.push({ label: 'HOOK content', value: 'empty (-)', isValid: true });
                contentChecks.push({ label: 'VO content', value: 'empty (-)', isValid: true });
                contentChecks.push({ label: 'MUSIC content', value: 'empty (-)', isValid: true });
                
            } else if (isBasicFormat) {
                // Basic format: [creator-type]_[filename]_[HOOK]_[VO]_[MUSIC]_[DIM]_[feature]_[language]
                structureChecks.push(checkStructure('Format', 'Basic format (without ID/creator/date)', true));
                structureChecks.push(checkStructure('Parts count', `${parts.length} parts (expected 7-9)`, parts.length >= 7 && parts.length <= 9));
                
                // Check creator type (index 0)
                const creatorType = parts[0];
                const validCreatorTypes = ['internal', 'freelancer', 'ramdam', 'influencer'];
                structureChecks.push(checkStructure('Creator Type', creatorType, validCreatorTypes.includes(creatorType)));
                
                // Check filename (index 1)
                const filename = parts[1];
                structureChecks.push(checkStructure('Filename', filename, /^[A-Za-z0-9-]+$/.test(filename)));
                
                // Check tags (indices 2-5)
                const hookPart = parts[2];
                const voPart = parts[3];
                const musicPart = parts[4];
                const dimPart = parts[5];
                
                structureChecks.push(checkStructure('HOOK tag', hookPart, hookPart.startsWith('HOOK-')));
                structureChecks.push(checkStructure('VO tag', voPart, voPart.startsWith('VO-')));
                structureChecks.push(checkStructure('MUSIC tag', musicPart, musicPart.startsWith('MUSIC-')));
                structureChecks.push(checkStructure('DIM tag', dimPart, ['PO', 'SQ', 'LS'].includes(dimPart)));
                
                // Check feature tag (index 6)
                const feature = parts[6];
                const validFeatures = ['AIBG', 'STORY', 'LOGO', 'ANIM', 'MIX', 'AIFILL', 'RETOUCH', 'CHANGE', 'IMGT-MODEL', 'IMGT-STAGE', 'IMGT-BEAUTIFY', 'RnD'];
                structureChecks.push(checkStructure('Feature tag', feature, validFeatures.includes(feature)));
                
                // Check language (index 7)
                const language = parts[7];
                const validLanguages = ['EN', 'FR', 'PT', 'ES', 'JA', 'KO', 'AR', 'ZH', 'DE', 'HI', 'ID', 'IT', 'MS', 'NL', 'PL', 'TH', 'TL', 'TR', 'VI', 'en', 'fr', 'pt', 'es', 'ja', 'ko', 'ar', 'zh', 'de', 'hi', 'id', 'it', 'ms', 'nl', 'pl', 'th', 'tl', 'tr', 'vi'];
                structureChecks.push(checkStructure('Language', language, validLanguages.includes(language)));
                
                // Content validation
                contentChecks.push(validateHookContent(hookPart));
                contentChecks.push(validateVoiceOverContent(voPart));
                contentChecks.push(validateMusicContent(musicPart));
                
            } else {
                result.message = 'Invalid format: Too few parts or unrecognized structure';
                result.structureBreakdown = '<div class="text-danger"><i class="fas fa-times"></i> Invalid structure</div>';
                result.contentBreakdown = '<div class="text-muted">Cannot validate content due to structure issues</div>';
                return result;
            }
            
            // Calculate overall validity
            const structureValid = structureChecks.every(check => check.isValid);
            const contentValid = contentChecks.every(check => check.isValid);
            result.isValid = structureValid && contentValid;
            
            // Generate messages
            if (result.isValid) {
                result.message = 'This creative name follows all naming conventions perfectly!';
            } else {
                const issues = [];
                if (!structureValid) issues.push('structure issues');
                if (!contentValid) issues.push('content validation issues');
                result.message = `Found ${issues.join(' and ')}. See breakdown below.`;
            }
            
            // Generate breakdowns
            result.structureBreakdown = structureChecks.map(check => 
                `<div class="${check.isValid ? 'text-success' : 'text-danger'}">
                    ${check.isValid ? '‚úÖ' : '‚ùå'} ${check.label}: ${check.value}
                </div>`
            ).join('');
            
            result.contentBreakdown = contentChecks.map(check => 
                `<div class="${check.isValid ? 'text-success' : 'text-danger'}">
                    ${check.isValid ? '‚úÖ' : '‚ùå'} ${check.label}: ${check.value}
                </div>`
            ).join('');
            
            return result;
        }
        
        // Helper functions
        function checkStructure(label, value, isValid) {
            return { label, value, isValid };
        }
        
        function validateHookContent(hookPart) {
            const hookValue = hookPart.replace('HOOK-', '');
            const validHooks = ['any', 'come', 'UGC', 'text', 'emoji', 'nonono', 'ASMR', 'AIUGC'];
            
            if (validHooks.includes(hookValue)) {
                return { label: 'HOOK content', value: hookValue, isValid: true };
            } else if (hookValue.startsWith('text-') || hookValue.startsWith('ugc-')) {
                return { label: 'HOOK content', value: hookValue, isValid: true };
            } else {
                return { label: 'HOOK content', value: hookValue, isValid: false };
            }
        }
        
        function validateVoiceOverContent(voPart) {
            const voValue = voPart.replace('VO-', '');
            const validVOs = ['any', 'null', 'tom', 'doja', 'chris', 'human'];
            
            if (validVOs.includes(voValue)) {
                return { label: 'VO content', value: voValue, isValid: true };
            } else if (voValue.includes('-') || voValue.length > 2) {
                return { label: 'VO content', value: voValue, isValid: true }; // Custom voice or with script
            } else {
                return { label: 'VO content', value: voValue, isValid: false };
            }
        }
        
        function validateMusicContent(musicPart) {
            const musicValue = musicPart.replace('MUSIC-', '');
            const validMusic = ['any', 'lofi', 'kpop', 'hiphop', '90s', 'trend'];
            
            if (validMusic.includes(musicValue)) {
                return { label: 'MUSIC content', value: musicValue, isValid: true };
            } else if (musicValue.length > 2) {
                return { label: 'MUSIC content', value: musicValue, isValid: true }; // Custom music
            } else {
                return { label: 'MUSIC content', value: musicValue, isValid: false };
            }
        }
        
        // Initialize preview on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize cached DOM elements
            initEls();
            
            // Set default values on page load
            creatorTypeEl.value = 'internal';
            hookEl.value = 'any';
            voiceOverEl.value = 'any';
            musicEl.value = 'any';
            dimensionEl.value = 'PO';
            featureEl.value = 'AIBG';
            languageEl.value = 'en';
            creativeNumberEl.value = '1';
            
            showCreativeTags();
            updatePreview();
        });
    </script>
{% endblock %}
